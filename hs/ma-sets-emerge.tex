%!TEX root = tales-main.tex


% Big theme here: Emergent properties
%	(i.e. what happens when we have this property (here, among members of sets)
%	we can get some interesting consequence (e.g. dimension))

\chapter{(Sets and Emergence)}

% Sth: "This might be the most boring way to start a chapter. In the past, we've talked about counting things -- here, we'll be talking about, quite literally, "things" (or more properly, collections of things)"


\section{(Sets -- collections of things)}

\begin{exercise}
What are the intersection and union of...
\begin{enumerate}[(a)]
\item ...the set $\{1, 2, 3\}$ and the set $\{2, 3, 4\}$?
\item ...the "null set" (the set with nothing in it) and any other set?
\item ...the set of all even integers, and the set of all odd integers?
\end{enumerate}
\end{exercise}

\begin{exercise}
What is the intersection of...
\begin{enumerate}[(a)]
\item ...the set of prime numbers, and the set of even numbers?
\item ...the set of integers divisible by 2, and the set of integers divisible by 3?
\end{enumerate}
\end{exercise}

% TODO: Need to have defined prime numbers at some point

\section{Problems}

%%%%%%%% Fixed-point iteration problems

\begin{problem}
\label{pr:fp-intro}
For any function $f$, we call $c$ a \textbf{fixed point} of $f$ if $f(c) = c$. 

(For functions involving real numbers, imagine fixed points as those points where the graph of $f(x)$ touches or crosses the line $y = x$.)

% TODO: Insert some figure here

\begin{enumerate}[(a)]
\item Find the fixed points of... 
\begin{enumerate}[i]
\item $f(x) = 3$
\item $f(x) = 2x + 1$
\item $f(x) = x^2$
\item $f(x) = x$
\item $f(x) = 1$ when $x$ is rational, and 0 when $x$ is irrational

(Assume $f$ maps real numbers to real numbers in each of the above cases.)
\end{enumerate}

For the purposes of this problem, let $f_2(x)$ = $f(f(x))$, $f_3(x) = f(f(f(x)))$, and so on. More formally, define let $f_1(x) = f(x)$, and $f_k(x) = f(f_{k-1}(x))$.

\item Prove that, if $c$ is a fixed point of $f$, then $c$ is also a fixed point of $f_k$ for all counting numbers $k \geq 1$. (This is a really short proof and may seem obvious, but it will play a key role soon.)
\end{enumerate}
\end{problem}

\begin{problem}
\label{pr:fp-iter}

% Let f be a real-valued function.

The "point" of Problem \ref{pr:fp-intro} was preparation for the following general problem: Suppose we have a function $f$, and some value $x_0$. What happens to the sequence $x_0$, $f(x_0)$, $f(f(x_0))$, $f(f(f(x_0)))$, ...? (Does it converge? Does it oscillate? Does it have some strange chaotic behavior?)

\begin{enumerate}[(a)]
\item Let's first consider $f(x) = x/3$. What does this pattern look like for various starting values?
\item Do the same with $f(x) = \cos(x)$.
\item Do the same with $f(x) = 2x$. 
\item Do the same with $f(x) = x/2 + 1$. 
\item Do the same with $f(x) = 4x(1-x)$. % TODO: Reference chaos theory stuff in the references section

While it is difficult to make general statements on the matter (there are whole fields devoted to the intricacies of this topic!), we can actually prove some pretty useful results.

%(We'll use the $f_k$ notation of Problem \ref{pr:fp-intro} to denote iterated functions.)

\item Suppose $f$ is a \emph{continuous} function, and we \emph{know} that, for some starting value $x_0$, the sequence $x_0$, $f(x_0)$, $f(f(x_0))$, $f(f(f(x_0)))$, ... converges to some value (call it $c$). Prove that $c$ is a fixed point of $f$.
\item Suppose $f$ didn't have to be continuous; find a counterexample to the above claim.

In other words, if we find that this sequence converges, it converges to a fixed point. But when does it converge at all? While we cannot cover all cases, we'll try to find some cases where this is true.

% TODO: More parts to this problem that aren't amoeba-related

\item Suppose now that $f$ is a continuous and \emph{increasing} function. 
\begin{enumerate}[i]
\item Suppose we also choose our "starting point" $x_0$ where $f(x_0) > x_0$, and there is exactly one fixed point $c > x_0$. Prove that the sequence $x_0$, $f(x_0)$, $f(f(x_0))$, $f(f(f(x_0)))$, ... converges to the closest such fixed point. 
\item Suppose we have the same scenario, except there are now multiple fixed points to the right of $x_0$. Which one will our sequence converge to, and why?
% TODO: Insert logical conclusions for f(x_0) < x_0, f is decreasing, etc? (maybe - don't really need them for amoeba problem)
\end{enumerate}

% TODO: Put diagram for this here or in hints?

% TODO: Also put diagram of what happens for multiple fixed points?




\end{enumerate}
\end{problem}


%%%%%%%% Amoeba problems

\begin{problem}
\label{pr:amoeba-ngen}
Suppose we have an amoeba. It has a probability $p_d$ of dying, and a probability $(1 - p_d)$ of dividing into two amoebas (which themselves have the same probabilities of dying vs. dividing). 

We'll say that the first amoeba is the 0th generation. Then, for any $n$-th generation amoeba, if it divides into children, said offspring are $(n+1)$-th generation amoebas. 

Let $P_d(n)$ be the probability that the family tree dies before the $n$-th generation.\footnote{In other words, the probability that this family tree does not produce an $n$-th generation amoeba.}

% TODO: Show tree figures of what this could look like?

\begin{enumerate}[(a)]
\item What is $P_d(1)$?
\item Find a recursive relation for $P_d(n)$, in terms of $P_d(n-1)$, for $n > 1$. 
\item Suppose we instead had $m$ starting amoebas. What is the probability of dying before the $n$-th generation now? Answer in terms of our original $P_d(n)$.
\item What is the probability that our amoeba family (with 1 starting amoeba) dies at some point in the future, period? (Alternatively, what is the probably that our family \emph{doesn't} die out at all -- and simply lives on forever?) %In particular, under what conditions (i.e. for what values of $p$) is the amoeba family certain to die at some point?
\end{enumerate}
\hfill
\end{problem}

%"Forever" essentially translates to $\lim_{n \rightarrow \infty} P_d(n)$. 

\begin{problem}
\label{pr:amoeba-kdesc}
Suppose we have the situation described in Problem \ref{pr:amoeba-ngen}, but we now have a "magical amoeba" that divides into $k$ children (and so does its descendants, and the descendants after that, etc), where $k \geq 2$. 

% TODO: Recommend (somewhere) to solve (and consult our solution) on ngen problem before this one?
\begin{enumerate}[(a)]
\item Intuitively, what should happen to the probability of the family tree's survival (for any $n$ generations and for eternity), as $k$ increases?
\item For what values of $p_d$ is our "magical amoeba family" certain to die?
\end{enumerate}
\end{problem}

%%%%%%%%%%%%%%

\newpage
\section{Terms and References}

\section{Hints}

\newpage
\section{Solutions}

\subsection{Problem \ref{pr:amoeba-ngen}}

\subsubsection{Part (a)}

$P_d(1)$ is simply the probability that we don't make it to first generation. This will only happen if the first amoeba dies, which happens with probability $p_d$.



\subsubsection{Part (b)}

A recap of the scenario here: We have one amoeba, and we'd like to see whether (or not) it produces a family tree that lives to at least $n$ generations.

% TODO: Potentially bee more clear here. Emphasize using the "divide the world into two possibilities" trick
There are two (mutually exclusive) ways for that amoeba's family tree to die off before then: 
\begin{enumerate}
\item This amoeba dies.
\item This amoeba lives to divide into two, but the family dies off later on.
\end{enumerate} \hfill

Let's clarify the second case a bit more. If our current amoeba has lived to reproduce, then the only way for the family to die out before $n$ generations is if \emph{both} of our children amoebas produce families that die out before $(n-1)$ generations, respective to them. By our definition, each such child amoeba has probability $P_d(n-1)$ of that occurring.

This looks promising recurrence-relation wise! Let's solidify our relation a bit more formally. We have: \footnote{It might seem a bit silly to write "dies in $<n$ generations from parent death" -- after all, not only does it die before the $n$-th generation, it dies before even the first one! But bear with us here.}

\begin{align*}
P_d(n) &:= P(\text{ family dies in $< n$ generations }) \\
&= P(\text{ family dies in $< n$ generations from parent death }) \\
&\qquad + P(\text{ family dies in $< n$ generations from later death }) \\ % mutually exclusive
\end{align*}


Rephrasing this a little bit, we have: \footnote{Note that, in the second equation, we're using the general notion that $P(B \cap A) = P\left(B \middle| A\right) \cdot P(A)$}
\begin{align*}
&= P(\text{ family dies in $< n$ generations AND parent dies }) \\
&\qquad + P(\text{ family dies $< n$ generations AND parent lives }) \\
&= P(\text{ parent dies }) \cdot P\left(\text{ family dies } \middle| \text{ parent dies }\right) \\
&\qquad + P(\text{ parent lives }) \cdot P\left(\text{ family dies } \middle| \text{ parent lives }\right) \\
&= p_d \cdot 1 \\
&\qquad + (1 - p_d) \cdot P\left(\text{ family dies } \middle| \text{ parent lives }\right)
\end{align*}

What is $P\left(\text{ family dies } \middle| \text{ parent lives }\right)$? In other words, what exactly is the probability that, even though the first amoeba divides into two, our family dies in $n$ generations (relative to the first amoeba) anyway? We know that each child amoeba then has to die in less than $(n-1)$ generations, which happens with probability $P_d(n-1)$, and there are two children. The reproduction of each child is independent of the other child, and hence both amoebas must independently have their family lines die under them in order for the amoeba line as a whole to die.

Therefore, 

\begin{align*}
&P\left(\text{ family dies in $<n$ generations } \middle| \text{ parent lives }\right) \\
&= P(\text{ family dies under child 1} \\
&\qquad\text{ AND family dies under child 2 }) \\
&= P\left(\text{ family dies under child 1} \right) \\ 
&\qquad\cdot P\left(\text{ family dies under child 2 } \right) \\
&= P_d(n-1) \cdot P_d(n-1) \\
&= P_d(n-1)^2
\end{align*}

%TODO: Fix super/subscript formatting
%TODO: "Generations" term is wrong, use some other word (like line)

Combining everything above, we get that $p_F$ must satisfy the following relation:

\begin{equation}
P_d(n) = p_d + (1-p_d) \cdot P_d(n-1)^2
\end{equation}


\subsubsection{Part (c)}

If we have $m$ starting amoebas, each amoeba proceeds in producing its family tree independently. In order for us to have no amoebas at generation $n$, each amoeba's family tree must independently die out before them. Hence, using very similar logic as in Part (b)'s independence discussion, we simply multiply for each of the $m$ amoebas, giving us $P_d(n)^m$. 

As a quick check on ourselves: Since probabilities are between 0 and 1, inclusive, $P_d(n)^m$ will decrease as $m$ increases. This is exactly what we expect, since our chances of complete death should go much lower if we have more amoebas to start with.

% TODO: Actually do the work here? 

\subsubsection{Part (d)}

We'd like to find the chances that our amoeba family simply never dies, and simply keeps on living forever. Alternatively, we're trying to find the probability that this \emph{doesn't} happen -- in other words, the probability that, at some point, the family dies.\footnote{The probability of either possibility is, of course, 1 minus the other.}

In theory, the latter possibility is simply the limit of $P_d(n)$ as $n$ approaches infinity. 

What is this limit? Does it even exist? Trying to find an explicit formula for $P_d(n)$ from our recurrence relation looks messy, at best (but you can try!) -- so let's try a different look at the problem.


\paragraph{Brief intuition}

Let's first try to intuit what happens -- in particular, at a few "edge" cases.

First, let's consider what happens at $p_d = 0$, which means that every amoeba will reproduce without dying. Then our family should obviously live forever, so our family death probability (for any $n$, and the limit as $n$ approaches infinity) should be 0.\footnote{Going back to our recurrence relation, this makes sense -- when $p_d = 0$, we have $P_d(n) = 0 + (1 - 0) \cdot P_d(n-1) = P_d(n-1)$. Given that $P_d(1) = p_d = 0$, it follows that $P_d(n) = 0$ for all $n$.}

Let's also consider what happens when $p_d > 1/2$. This effectively means that it is more likely for an amoeba to die than it is to reproduce. If we look at this from an "expected value" viewpoint, then we expect the population to go down as time goes on -- so our survival probability in the timeframe of "forever" should be very low, if anything at all!

But let's do a more rigorous analysis. Will it support our intuition?


\paragraph{Fixed-point iteration returns!}

Consider the function $f(x) = p_d + (1 - p_d)x^2$. 

Let's say we have $x_0 = P_d(1) = p_d$, from Part (a). Then, by definition, $P_d(2)$ is equal to $f(x_0)$. Furthermore, $P_d(3) = f(P_d(2)) = f(f(x_0))$, and $P_d(4) = f(P_d(3)) = f(f(f(x_0)))$, and so on.

This is starting to look like a function iteration problem! More specifically, we can say $P_d(n+1) = f_n(x_0)$ for $n > 1$. 

From our previous problems, we have a hunch that the fixed points of $f$ can be important. They are simply the solutions to the equation $x = f(x)$, i.e.

\begin{equation*}
x = p_d + (1 - p_d)x^2
\end{equation*}

Solving this equation\footnote{We can use the "quadratic formula" here.} gives two solutions (which we'll call $x_a$ and $x_b$):
\begin{equation*}
x_a = 1
\end{equation*}
and 
\begin{equation*}
x_b = \frac{p_d}{1 - p_d}
\end{equation*}

One key thing we see: $x_a = x_b$ when $p_d = 1/2$. In fact, when $p_d > 1/2$, $x_b > x_a$ (and when $p_d < 1/2$, $x_b < x_a$). 

% TODO: Insert figure of graph for various values of p_d. Give one color to those < 1/2, one to those >, and one to those equal. Put dots at the fixed points



\paragraph{The actual solution}

Why was that all important? Three more key facts:

\begin{itemize}
\item $f$ is continuous and increasing for $x > 0$. 
\item $f(x) > x$ before the first fixed point. 
\item Our starting point, $x_0$, is simply $p_d$. Note that $p_d \leq x_a$ (because $p_d \leq 1$), and since $(1 - p_d) \leq 1$, we have $p_d \leq x_b$ as well. Hence, our starting point is to the left of both fixed points (or on top of one -- we'll take care of that special case shortly). 
\end{itemize}

Now comes our big realization. Remember Problem \ref{pr:fp-iter}? We've met all the conditions to show that, once we start iterating at $p_d$, our limit is the \emph{closest} fixed point to the right -- in other words, the lesser of $x_a$ and $x_b$.

What does that mean for us? Let's consider 3 cases:

\begin{itemize}
\item $p_d > 1/2$: The leftmost fixed point is 1, so our iterated function limit, i.e. $\lim_{n \rightarrow \infty} P_d(n)$, is 1. Therefore, our amoeba family is certain to die at some point. (How sad.)\footnote{We actually could have had a quick "side-channel" solution for this case. If $p_d > 1/2$, then $p_d / (1 - p_d) > 1$, so it would be nonsensical to have that has a probability value. However, hopefully the rigor we worked through hopefully gives a more solid-feeling justification}
\item $p_d = 1/2$: Here, in fact, we only have one fixed point (since $x_a = x_b$), which is 1. Hence, our amoeba family will, at some point, die.
\item $p_d < 1/2$: The leftmost fixed point is now $p_d / (1 - p_d)$, which must then be our iterated function limit (i.e. $\lim_{n \rightarrow \infty} P_d(n)$). For $p_d < 1/2$, this value is less than 1 -- in other words, our amoeba family might live on forever!
\end{itemize}


\paragraph{(Philosophizing)}

%TODO: More intuition? (especially in the expected-value sense)

% TODO: Get more into what this p_d / (1 - p_d) relation looks like? (Graph, numerical example at edge cases, etc) instead of (just?) the numerical example below.

% TODO: More philosophizing in general

% TODO: Possibly make this whole thing link back to "first principles" (probability spaces, etc). However, this can probably occur in the recurrence relation section. 

$\square$


\subsection{Problem \ref{pr:amoeba-kdesc}}

\subsubsection{Part (a)}

Intuitively (or at the very least, "it feels like") the probability of family death should decrease as $k$ increases.

More significantly, consider the following phenomenon: The "further one gets" along the family tree, the more likely it seems that the family will survive indefinitely. As a brief example, consider having the one starting amoeba versus the two amoebas that come after it in our original (upon successful reproduction) -- our conditional chances are a lot better in the latter case.\footnote{More precisely, as we found earlier, the chances of death are $p_F^2$ after division, as opposed to $p_F$ before it -- and since $0 \leq p_F \leq 1$, $p_F^2 < p_F$.}

As $k$ increases, the degree to which we're "better off" after our first amoeba should be much higher. In fact, the big determiner in our family survival should be whether the first amoeba dies!\footnote{Think "carrying the team" here.} Therefore, intuitively, the probability of family survival should approach the probability of the first amoeba's death, which is simply $p_d$. 

Of course, in the last problem, we ran into the issue where, if $p_d$ is too high, family death is simply certain. When is $p_d$ too high here? We'll find out in the next part!

\subsubsection{Part (b)}

To start, we'll take a very similar approach as that of the last problem.

\paragraph{Preliminary work}

We'll re-use notation a bit, and let $P_d(n)$ denote the probability of family death before $n$ generations. 

Hopefully you believe that, with $k$ descendants per (surviving) amoeba, 

\begin{equation*}
P_d(n) = p_d + (1 - p_d) P_d(n-1)^k
\end{equation*}

Now, consider the function 

\begin{equation}
f(x) = p_d + (1 - p_d) x^k
\end{equation} 

Using the same logic as before, we now have $P_d(n+1) = f_n(p_d)$.\footnote{Inserting our starting value here directly, instead of calling it $x_0$.}

\paragraph{(Exploration)}

We now have a slight problem: For arbitrary $k$, we can't explicitly solve for all of the fixed points of $f$. % TODO: Mention why - might be able to link back into previous work

Let's explore a bit. What happens if we keep $p$ constant, and vary $k$?

% TODO: Insert "thinking" and graphs of what happens as we vary k, and as we vary p

What happens if we keep $k$ constant, and vary $p$?

% TODO: Philosophize more on exploration

% TODO stuff to write: It seems like we still have a very similar to the $k = 2$ case - it's almost as if we still have two fixed points, except perhaps at some "turning point". It also seems like x = 1 is still always a fixed point, and that the other one "moves to the right" as p_d increases, until it passes 1. The probability at which it passes 1 seems to be a higher value of p, as k increases.
%
% In addition, we see the behavior we intuitively thought about earlier -- as k increases (with p_d held constant), it looks like, as long as p_d is low enough, the leftmost fixed point approaches p_d


\paragraph{The actual proof}

%We'll now prove that $f$ has at most two fixed points. In the process, we'll show what $p_d$ has to be, in order for death to be certain! 

Consider the function

\begin{align*}
g(x) &= f(x) - x \\
&= p_d + (1 - p_d)x^k - x
\end{align*}

Then

\begin{equation}
g'(x) = (1 - p_d)kx^{k-1} - 1
\end{equation}

and

\begin{equation}
g''(x) = (1 - p_d)k(k-1)x^{k-2}
\end{equation}

Note that $g''(x)$ is positive whenever $x > 0$, so from $x = 0$ on, $g$ is convex. Per Problem \ref{pr:convex-root-limit}, we know that $g$ will have at most 2 roots. % TODO: Mention something like "recall that it could have 0, 1, or 2, depending on (cases)"

We clearly see (by plugging in) that $g(1) = 0$, which gives us at least one root.\footnote{This makes sense: From our graphs, we suspected that this was true. One could have also plugged in to see that $f(1) = p_d + (1 - p_d) = 1$.}

This gives us these possibilities:

\begin{itemize}
\item $g$ has exactly two roots. We divide this into separate cases regarding the second root:
\begin{itemize}
\item $g$ has a root $x_a < 1$: 
\end{itemize}
\item $g$ has exactly one root, at $x = 1$. This will only happen if and only if $g'(1) = 0$.
\end{itemize}

% TODO: Actually fill this in with IVT/deriv proof details and stuff.

% TODO: Figure describing these three possibilities. Label things!





% TODO: What did we do here? In theory, we could have done this when k = 2, in the last problem. However, we had the solutions explicitly there. Here, we had to show that an additional solution besides x = 1 exists, even though we can't actually give a formula for it. 






